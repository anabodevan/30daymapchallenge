{
  "hash": "7d2f259a42e47904c3c6310804e86d9b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Points\"\nauthor: \"Ana Luisa Bodevan\"\ndescription: \"France's nuclear power plants\"\nimage: \"01_Points.png\"\nexecute:\n  warning: false\n  message: false\n  eval: true\nformat:\n  html:\n    code-tools: true\n    code-fold: true\n---\n\n# Day 1: Points\n\n| Challenge Classic: Map with point data (e.g., individual locations, points of interest, clusters). Focus on effective symbolization and density visualization.\n\nFor this one, we will be looking into the nuclear power plants of France, one of the world's largest investors in nuclear energy.\n\n## 1. SETUP\n\n### 1.1 Load libraries and data\n\nThe data will is from [Wikipedia](https://en.wikipedia.org/wiki/List_of_power_stations_in_France)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pacman)\npacman :: p_load(tidyverse, dplyr, ragg, showtext, sf, stringr, rnaturalearth, rnaturalearthdata,\n                  ggrepel, ggspatial)\n\n# Active Nuclear Power Plants\nactive_plants <- data.frame(\n  name = c(\"Belleville NPP\", \"Blayais NPP\", \"Bugey\", \"Cattenom NPP\", \n           \"Chinon NPP\", \"Chooz-B NPP\", \"Civaux NPP\", \"Cruas NPP\", \n           \"Dampierre NPP\", \"Flamanville NPP\", \"Golfech NPP\", \"Gravelines NPP\",\n           \"Nogent NPP\", \"Paluel NPP\", \"Penly NPP\", \"Saint-Alban NPP\",\n           \"Saint-Laurent-B NPP\", \"Tricastin NPC\"),\n  location = c(\"Belleville-sur-Loire\", \"Braud-et-Saint-Louis\", \"Saint-Vulbas\", \n               \"Cattenom\", \"Avoine\", \"Chooz\", \"Civaux\", \"Cruas\",\n               \"Dampierre-en-Burly\", \"Flamanville\", \"Golfech\", \"Gravelines\",\n               \"Nogent-sur-Seine\", \"Paluel\", \"Penly\", \"Saint-Alban-du-Rhône\",\n               \"Saint-Laurent-Nouan\", \"Bollène\"),\n  latitude = c(47.510534, 45.255833, 45.798333, 49.4158, 47.230556, 50.09, \n               46.456667, 44.633056, 47.7336808, 49.536389, 44.1067, 51.015278,\n               48.515278, 49.858056, 49.976667, 45.4042957, 47.72, 44.329722),\n  longitude = c(2.8761864, -0.693056, 5.270833, 6.2181, 0.170556, 4.789444,\n                0.652778, 4.756667, 2.5172853, -1.881667, 0.8453, 2.136111,\n                3.517778, 0.635556, 1.211944, 4.7555351, 1.5775, 4.732222),\n  entered_operation = c(\"1987-1988\", \"1981-1983\", \"1972\", \"1986-1991\", \n                        \"1988\", \"1998-2000\", \"1998-2000\", \"1983-1984\",\n                        \"1980-1981\", \"1985-2020\", \"1991-1993\", \"1980-1985\",\n                        \"1987-1988\", \"1985-1986\", \"1990-1992\", \"1985-1986\",\n                        \"1981\", \"1983-1984\"),\n  retired = \"N\",\n  stringsAsFactors = FALSE\n)\n\n# Retired Nuclear Power Plants\nretired_plants <- data.frame(\n  name = c(\"Brennilis NPP\", \"Fessenheim NPP\", \"Marcoule-G1\", \"Marcoule-G2 & G3\",\n           \"Phénix\", \"Superphénix\"),\n  location = c(\"Brennilis\", \"Fessenheim\", \"Bagnols-sur-Cèze\", \"Bagnols-sur-Cèze\",\n               \"Bagnols-sur-Cèze\", \"Creys-Mépieu\"),\n  latitude = c(48.3533, 47.9032247, 44.143333, 44.143333, 44.143333, 45.758333),\n  longitude = c(-3.872203, 7.5623059, 4.709444, 4.709444, 4.711667, 5.472222),\n  entered_operation = c(\"1967\", \"1977\", \"1956\", \"1959\", \"1973\", \"1986\"),\n  retired = \"Y\",\n  stringsAsFactors = FALSE\n)\n\n# Combine both datasets\nfrance_nuclear_plants <- bind_rows(active_plants, retired_plants)\n\nhead(france_nuclear_plants)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            name             location latitude longitude entered_operation\n1 Belleville NPP Belleville-sur-Loire 47.51053  2.876186         1987-1988\n2    Blayais NPP Braud-et-Saint-Louis 45.25583 -0.693056         1981-1983\n3          Bugey         Saint-Vulbas 45.79833  5.270833              1972\n4   Cattenom NPP             Cattenom 49.41580  6.218100         1986-1991\n5     Chinon NPP               Avoine 47.23056  0.170556              1988\n6    Chooz-B NPP                Chooz 50.09000  4.789444         1998-2000\n  retired\n1       N\n2       N\n3       N\n4       N\n5       N\n6       N\n```\n\n\n:::\n:::\n\n\nNow we know France has 24 nuclear facilities, with 18 of them active, and also their coordinates.\n\n## 2. DATA WRANGLING\n\nNow that we have our \"points\", we need the background layer - the map of France itself. The country boundaries can be easily acessed using `rnaturalearth` and `rnaturaleathdata` and `sf` makes ease to deal with spatial data. We will also need to convert the `france_nuclear_plants` dataset to a sf object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get France map data\nfrance <- ne_countries(scale = \"medium\", country = \"France\", returnclass = \"sf\")\n\n# Convert nuclear plants to sf object\nnuclear_sf <- st_as_sf(france_nuclear_plants, \n                       coords = c(\"longitude\", \"latitude\"),\n                       crs = 4326)\n\n# Get neighboring countries for context\nneighbors <- ne_countries(scale = \"medium\", \n                         country = c(\"Germany\", \"Belgium\", \"Switzerland\", \n                                   \"Italy\", \"Spain\", \"Luxembourg\", \"Andorra\"),\n                         returnclass = \"sf\")\n\nnuclear_sf_age <- nuclear_sf %>%\n  mutate(\n    # Extract first year from entered_operation\n    year_start = as.numeric(str_extract(entered_operation, \"\\\\d{4}\")),\n    age = 2025 - year_start,\n    age_group = case_when(\n      retired == \"Y\" ~ \"Retired\",\n      age < 30 ~ \"1995+\",\n      age < 40 ~ \"1985-1994\", \n      TRUE ~ \"<1985\"\n    ),\n    age_group = factor(age_group, levels = c(\"<1985\", \"1985-1994\", \"1995+\", \"Retired\"))\n  )\n```\n:::\n\n\n## 3. PLOT\n\n### 3.1 Base plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # France base map\n  geom_sf(data = france, fill = \"#f0f0f0\", color = \"#333333\", size = 0.5) +\n  # Nuclear plants points\n  geom_sf(data = nuclear_sf, aes(color = retired, shape = retired), \n          size = 3, alpha = 0.8) +\n  coord_sf(xlim = c(-5, 10), ylim = c(41, 52)) # zoom on mainland france\n```\n\n::: {.cell-output-display}\n![](01_points_files/figure-html/sbase plot-1.png){width=672}\n:::\n:::\n\n\n### 3.2 Set theme\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_30d <- function() {\n  theme_void() +\n    theme(\n      plot.title = element_text(\n        size = 18,\n        face = \"bold\",\n        color = \"#333333\",\n        margin = margin(b = 10)\n      ),\n      plot.subtitle = element_text(\n        size = 14,\n        color = \"#999999\",\n        margin = margin(b = 10)\n      ),\n      plot.caption = element_text(\n        size = 13,\n        color = \"#777777\",\n        margin = margin(t = 15),\n        hjust = 0\n      ),\n      plot.title.position = \"plot\",\n      plot.caption.position = \"plot\",\n      # Remove axes & gridlines completely\n      axis.text = element_blank(),\n      axis.title = element_blank(),\n      axis.ticks = element_blank(),\n      panel.grid = element_blank()\n    )\n}\n```\n:::\n\n\n### 3.3 Set fonts and colors\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add_google(\"Libre Franklin\", \"librefranklin\")\nfont_add_google(\"Inter\", \"inter\")\n\nfont_title <- \"librefranklin\"\nfont_body <- \"inter\"\nshowtext_auto()\n\npal <- c(\"#0055A4\", \"#EF4135\")\n\ntitle <- \"France Went Nuclear\"\nsubtitle = \"With 18 active plants and 57 reactors, 70% of France's electricity comes\\nfrom nuclear energy, the highest share of any country worldwide\"\ncaption <- \"Data: Wikipedia & World Nuclear Association\\n#30DayMapChallenge Day 1: Points | @anabodevan\"\n```\n:::\n\n\n### 3.4 Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # Neighboring countries (background)\n  geom_sf(data = neighbors, fill = \"#F5F5F5\", color = \"#DDDDDD\", linewidth = 0.3) +\n\n  # France outline\n  geom_sf(data = france, fill = \"white\", color = \"#06174F\", linewidth = 0.8) +\n\n  # Nuclear plants points\n  geom_sf(\n    data = nuclear_sf_age,\n    aes(color = age_group, shape = age_group),\n    size = 4, stroke = 1.2\n  ) +\n\n  # Color and shape scales\n  scale_color_manual(\n    values = c(\n      \"<1985\" = \"#003D82\",        # Dark blue\n      \"1985-1994\" = \"#0055A4\",    # Medium blue\n      \"1995+\" = \"#4A90E2\",        # Light blue\n      \"Retired\" = \"#EF4135\"       # Red\n    ),\n    name = \"Entered Operation\"\n  ) +\n  scale_shape_manual(\n    values = c(\n      \"<1985\" = 19,\n      \"1985-1994\" = 19,\n      \"1995+\" = 19,\n      \"Retired\" = 4\n    ),\n    name = \"Entered Operation\"\n  ) +\n\n  # Labels\n  labs(\n    title = title,\n    subtitle = subtitle,\n    caption = caption,\n    x = NULL, y = NULL\n  ) +\n\n  # Custom theme\n  theme_30d() +\n  theme(\n    text = element_text(family = font_body),\n    plot.title = element_text(\n      family = font_title,\n      size = 30, face = \"bold\", color = \"#002395\",\n      margin = margin(b = 12), hjust = 0\n    ),\n    plot.subtitle = element_text(\n      family = font_body,\n      size = 17, color = \"#363535\", margin = margin(b = 30), hjust = 0\n    ),\n    plot.caption = element_text(\n      family = font_body,\n      size = 11, color = \"#5A5A5A\", hjust = 0.5, margin = margin(t = 15)\n    ),\n    legend.position = \"bottom\",\n    legend.direction = \"horizontal\",\n    legend.title = element_text(family = font_body, face = \"bold\", size = 12),\n    legend.text = element_text(family = font_body, size = 12),\n    legend.background = element_blank(),\n    legend.key = element_blank(),\n    legend.key.size = unit(0.8, \"cm\"),\n    legend.spacing.x = unit(0.4, \"cm\"),\n    plot.margin = margin(20, 20, 20, 20),\n    panel.background = element_rect(fill = \"white\", color = NA),\n    plot.background = element_rect(fill = \"white\", color = NA)\n  ) +\n\n  # Enhanced legend\n  guides(\n    color = guide_legend(\n      override.aes = list(size = 4),\n      nrow = 1, title.position = \"top\", title.hjust = 0.5\n    ),\n    shape = guide_legend(\n      override.aes = list(size = 4),\n      nrow = 1, title.position = \"top\", title.hjust = 0.5\n    )\n  ) +\n\n  # Proper bounding box for France \n  coord_sf(\n    xlim = c(-5.5, 10),\n    ylim = c(41, 52),\n    expand = FALSE,\n    clip = \"off\"\n  )\n```\n:::\n\n\n![](01_points.png){fig-align=\"center\" width=\"591\"}",
    "supporting": [
      "01_points_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "5e60a78b8a9f189f79f6733e763d76e6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Points\"\ndate: 2025-11-01\nimage: 01_points.png\nauthor: \"Ana Bodevan\"\nformat:\n  html:\n    code-fold: show\nexecute:\n  echo: true\n  warning: false\n  message: false\n---\n\n# Day 01 - Points\n\nChallenge Classic: Map with point data (e.g., individual locations, points of interest, clusters). Focus on effective symbolization and density visualization.\n\nFor this one, we will be looking at the [List of Largest LGBT Events](https://en.wikipedia.org/wiki/List_of_largest_LGBTQ_events) on Wikipedia and map them by size.\n\n## SETUP\n\n### 1.1 Load Libraries and Data \n\nIn order to get the data from Wikipedia to our R, we will use the `rvest` package\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pacman)\npacman::p_load(tidyverse, ragg, rvest, rnaturalearth, showtext, \n              janitor, sf, tidygeocoder, ggrepel, scales)\n\nevents_raw <- read_html(\"https://en.wikipedia.org/wiki/List_of_largest_LGBT_events\") |> \n  html_table() |> \n  purrr::pluck(4) |>  \n  janitor::clean_names()\n\nworld <- ne_countries(scale = \"medium\", returnclass = \"sf\")\n```\n:::\n\n\n## 2. DATA WRANGLING\n\nNow that we have the raw table, it is necessary to clean and transform the data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nevents <- events_raw |> \n  mutate(\n    rank = str_remove(rank, \" \\\\(tie\\\\)\"), # remove the \"tie\" events \n    # transform strings into numbers\n    organizers_statistics = str_remove(organizers_statistics, \"\\\\+*\\\\[.+\"),\n    organizers_statistics = parse_number(organizers_statistics),\n    authorities_statistics = str_remove(authorities_statistics, \"\\\\+*\\\\[.+\"),\n    authorities_statistics = parse_number(authorities_statistics),\n    # creates a new column for attendence with organizer_statistics, or authorities if necessary\n    attendance = if_else(!is.na(organizers_statistics), organizers_statistics, authorities_statistics)\n  ) |> \n    # select the most recent event per city\n  group_by(city) |> \n  slice_max(order_by = year, n = 1) |> \n  ungroup()\n\nhead(events)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 8\n  rank  city    support  year organizers_statistics authorities_statistics type \n  <chr> <chr>   <chr>   <int>                 <dbl>                  <dbl> <chr>\n1 36    Amster… Local    2014                560000                 450000 Para…\n2 47    Atlanta Local    2018                300000                     NA Para…\n3 58    Belo H… Local    2019                200000                 200000 Para…\n4 46    Berlin  Local    2022                    NA                 350000 Para…\n5 34    Boston  Local    2019                750000                     NA Para…\n6 42    Bright… Local    2018                450000                 450000 Para…\n# ℹ 1 more variable: attendance <dbl>\n```\n\n\n:::\n:::\n\n\nIn order to correctly place the points in our map, we will need the coordinates for the cities present in the dataset. The `tidygeocoder` package will get this info for us automatically (a huge help! I used to depend on Google and AI to do this...)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nevents_geo <- events |> \n  slice_max(order_by = attendance, n = 10) |> # keep only the top 20 to avoid convolution \n  distinct(city, .keep_all = TRUE) |> \n  geocode(city = city, method = \"osm\")\n\n# Convert to sf object \nevents_geo_sf <- st_as_sf(events_geo, coords = c(\"long\", \"lat\"), crs = 4326)\nevents_geo_sf <- events_geo_sf |>\n  arrange(desc(attendance)) |>\n  mutate(\n    city_color = factor(city, levels = city)\n  )\n\n# Transform to Natural Earth projection\nnatearth_crs <- \"+proj=natearth +lon_0=0 +datum=WGS84\"\nworld_transformed <- st_transform(world, crs = natearth_crs)\nevents_transformed <- st_transform(events_geo_sf, crs = natearth_crs)\n```\n:::\n\n\nIf all our data clean and ready, we can start the actual plotting.\n \n## 3. PLOT \n\n### 3.1 Aesthetics ✨\n\n#### Fonts and Text\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_title <- \"Libre Franklin\"\nfont_body <- \"Inter\"\nshowtext_auto()\n\ntitle <- \"Largest LGBT Events Worldwide\"\nsubtitle <- \"Most recent event per city (top 10), sized by estimated attendence\"\ncaption <- \"Source: Wikipedia | #30DayMapChallenge | @anabodevan\"\n\nlegend_data <- data.frame(\n  size = c(1e6, 2e6, 4e6),\n  label = c(\"1M\", \"2M\", \"4M\")\n)\n```\n:::\n\n\n#### Colors\n\n::: {.cell}\n\n```{.r .cell-code}\npal <- c(\n  \"#E40303\",  # Red\n  \"#FF8C00\",  # Orange\n  \"#FFED00\",  # Yellow\n  \"#008026\",  # Green\n  \"#24408E\",  # Indigo\n  \"#732982\",  # Violet\n  \"#FF69B4\",  # Pink\n  \"#00CED1\",  # Turquoise\n  \"#9370DB\",  # Medium Purple\n  \"#FFD700\"   # Gold\n)\n```\n:::\n\n\n### 3.2 Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # World map first\n  geom_sf(data = world_transformed, fill = \"black\", color = \"transparent\", linewidth = 0.2) +\n  \n# Event points with pride gradient\n  geom_sf(\n    data = events_transformed,\n    aes(size = attendance, fill = city_color),\n    alpha = 0.9,\n    shape = 21,\n    color = \"white\",\n    stroke = 1\n  ) +\n  \n  # Discrete colors using pride palette\n  scale_fill_manual(\n    values = pal,\n    labels = paste0(\n    events_geo_sf |> arrange(desc(attendance)) |> pull(city),\n    \" - \",\n    round((events_geo_sf |> arrange(desc(attendance)) |> pull(attendance)) / 1e6, 1),\n    \"M (\",\n    events_geo_sf |> arrange(desc(attendance)) |> pull(year),\n    \")\"\n  ),\n    name = NULL,\n    guide = guide_legend(\n    override.aes = list(size = 5),\n    keywidth = 1,\n    keyheight = 1\n  )\n) +\n  \n  scale_size_area(max_size = 10, guide = \"none\") + \n  \n  # Natural Earth projection \n  coord_sf(datum = natearth_crs) +\n  \n  labs(\n    title = title,\n    subtitle = subtitle, \n    caption = caption\n  ) + \n  \n  theme_void(base_family = font_body) +\n  theme(\n    plot.title = element_text(\n      size = 40, \n      face = \"bold\", \n      hjust = 0.5,\n      margin = margin(t = 10, b = 5),\n      family = font_title\n    ),\n    plot.subtitle = element_text(\n      size = 20, \n      hjust = 0.5,\n      margin = margin(b = 15),\n      color = \"#131212de\"\n    ),\n    plot.caption = element_text(\n      size = 12, \n      hjust = 0.5,\n      margin = margin(t = 10, b = 5),\n      color = \"#666666\"),\n\n    plot.margin = margin(20, 20, 20, 20),\n    plot.background = element_rect(fill = \"white\", color = NA),\n    legend.position = \"right\",\n    legend.text = element_text(size = 16, family = font_body),\n    legend.spacing.y = unit(0.4, \"cm\")\n  )\n```\n\n::: {.cell-output-display}\n![](01_points_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "01_points_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "cc8a6b532375e60f0f064409de3afb75",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Urban\"\nauthor: \"Ana Luisa Bodevan\"\ndescription: \"\"\nimage: \"08_urban.png\"\nexecute:\n  warning: false\n  message: false\n  eval: false\nformat:\n  html:\n    code-tools: true\n    code-fold: true\n---\n\n# Day 8 - Urban\n\n| (World Urbanism Day) Map the built environment: dense street networks, highrises, urban sprawl, city infrastructure, or population density within a metro area.\n\nWell, I am late already. For today, we will make a quick map of my hometown, Belo Horizonte, using Open Street Map data and the `geobr` package.\n\n### Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(osmdata)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(geobr)\nlibrary(ggtext)\nlibrary(showtext)\n```\n:::\n\n\n### Get boundaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get Belo Horizonte municipality boundary from geobr\nbh_boundary <- read_municipality(code_muni = 3106200, year = 2020)\n\n# Define center point (approximate center of BH downtown)\ncenter_lon <- -43.9378\ncenter_lat <- -19.9167\n\n# Create a circular boundary (radius in meters)\nradius <- 5000  # 5km radius - adjust as needed\n\n# Create center point and transform to UTM\ncenter_point <- st_point(c(center_lon, center_lat)) %>%\n  st_sfc(crs = 4326) %>%\n  st_transform(crs = 31983)\n\n# Create circular boundary\ncircle <- st_buffer(center_point, dist = radius)\n\n# Get bounding box for OSM query\ncircle_wgs84 <- st_transform(circle, crs = 4326)\nbbox <- st_bbox(circle_wgs84)\n\n# Get all roads within the bounding box\nroads <- opq(bbox = bbox) %>%\n  add_osm_feature(key = \"highway\") %>%\n  osmdata_sf()\n\nroads_lines <- roads$osm_lines\n```\n:::\n\n\n### Transform, clip, classify\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transform roads to UTM\nroads_utm <- st_transform(roads_lines, crs = 31983)\n\n# Clip roads to circular boundary\nroads_clipped <- st_intersection(roads_utm, circle)\n\n# Transform back to WGS84 for plotting\nroads_plot <- st_transform(roads_clipped, crs = 4326)\ncircle_plot <- st_transform(circle, crs = 4326)\n\n# Classify roads by type for different styling\nroads_plot <- roads_plot %>%\n  mutate(road_type = case_when(\n    highway %in% c(\"motorway\", \"trunk\") ~ \"major\",\n    highway %in% c(\"primary\", \"secondary\") ~ \"medium\",\n    highway %in% c(\"tertiary\", \"residential\", \"unclassified\") ~ \"minor\",\n    TRUE ~ \"other\"\n  ))\n```\n:::\n\n\n### Fonts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfont_add_google(\"Ubuntu\", \"ubuntu\")\nshowtext_auto()\n```\n:::\n\n\n### Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # Background circle\n  geom_sf(data = circle_plot, fill = \"#f5f3ed\", color = \"#2a2a2a\", size = 1.5) +\n  # Plot roads by type with different widths\n  geom_sf(data = roads_plot %>% filter(road_type == \"other\"), \n          color = \"#4a4a4a\", size = 0.15, alpha = 0.5) +\n  geom_sf(data = roads_plot %>% filter(road_type == \"minor\"), \n          color = \"#3a3a3a\", size = 0.3, alpha = 0.7) +\n  geom_sf(data = roads_plot %>% filter(road_type == \"medium\"), \n          color = \"#2a2a2a\", size = 0.5, alpha = 0.8) +\n  geom_sf(data = roads_plot %>% filter(road_type == \"major\"), \n          color = \"#1a1a1a\", size = 0.8, alpha = 0.9) +\n  # Styling to match the reference image\n  theme_void() +\n  theme(\n    plot.background = element_rect(fill = \"#e8e8e4\", color = NA),\n    panel.background = element_rect(fill = \"#e8e8e4\", color = NA),\n    plot.margin = margin(40, 40, 40, 40),\n    plot.title = element_text(hjust = 0.5, size = 36, face = \"bold\",\n                              family = \"ubuntu\", color = \"#2a2a2a\",\n                              margin = margin(b = 20)),\n    plot.caption = element_text(hjust = 0.5, size = 10,\n                                family = \"ubuntu\", color = \"gray40\",\n                                margin = margin(t = 40))\n  ) +\n  coord_sf(datum = NA, expand = FALSE) +\n  labs(title = \"BELO HORIZONTE\",\n       caption = \"#30DayMapChallenge Day 8 - Urban\\nGraphic: Ana Bodevan\")\n```\n:::\n\n\n![](08_urban.png){fig-align=\"center\"}",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}